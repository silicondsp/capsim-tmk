



<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">


<html>


<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"></meta>
<title>

plottxt

</title>
<style type="text/css">
<!--
.style2 {font-size: 12px}
.style3 {
	font-size: x-large;
	font-weight: bold;
}
.style5 {font-family: "Courier New", Courier, mono}
-->
</style>
</head>
<body>

<h1>

plottxt

<a name="top"></a></h1>
<p><a href="http://www.xcad.com">Capsim</a> Block Documentation </p>
<ul>
  <li><a href="#license">License</a></li>
  <li><a href="#description">Description</a></li>
  <li><a href="#inputs">Input Connections</a></li>
  <li><a href="#outputs">Output Connections</a></li>
  <li><a href="#parameters">Parameters</a></li>
  <li><a href="#Results">Result Variables</a></li>
  <li><a href="#states">States</a></li>
  <li><a href="#declarations">Declarations</a></li>
  <li><a href="#initialization">Initialization Code</a></li>
  <li><a href="#maincode">Main Code</a></li>
  <li><a href="#wrapup">Wrapup Code</a></li>
</ul>





<h2>Short Description</h2><P>


Plot probe.


<h6><a href="#top">Top</a></h6>
<table width="746" border="1" cellspacing="1" cellpadding="1">
  <caption>
  <span class="style3">  Parameters<a name="parameters"></a> </span>
  </caption>
  <tr>
    <th width="58" scope="col">Num</th>
    <th width="373" scope="col">Description</th>
    <th width="80" scope="col">Type</th>
    <th width="98" scope="col">Name</th>
    <th width="109" scope="col">Default Value </th>
  </tr>

  


 <tr>
    <td>
    
    0
    
    </td>
    <td>
    
    Number of points in each plot (dynamic window size)
    
    </td>
    <td>
    
    int
    
    </td>
    <td>
    
    npts
    
    </td>
    <td>
    
    128
    
    </td>
    <td>
     </tr>
    
 



 <tr>
    <td>
    
    1
    
    </td>
    <td>
    
    Points to skip before first plot
    
    </td>
    <td>
    
    int
    
    </td>
    <td>
    
    skip
    
    </td>
    <td>
    
    0
    
    </td>
    <td>
     </tr>
    
 



 <tr>
    <td>
    
    2
    
    </td>
    <td>
    
    Plot title
    
    </td>
    <td>
    
    file
    
    </td>
    <td>
    
    title
    
    </td>
    <td>
    
    plot
    
    </td>
    <td>
     </tr>
    
 



 <tr>
    <td>
    
    3
    
    </td>
    <td>
    
    X Axis label
    
    </td>
    <td>
    
    file
    
    </td>
    <td>
    
    x_axis
    
    </td>
    <td>
    
    Samples
    
    </td>
    <td>
     </tr>
    
 



 <tr>
    <td>
    
    4
    
    </td>
    <td>
    
    Y-Axis label
    
    </td>
    <td>
    
    file
    
    </td>
    <td>
    
    y_axis
    
    </td>
    <td>
    
    Y
    
    </td>
    <td>
     </tr>
    
 



 <tr>
    <td>
    
    5
    
    </td>
    <td>
    
    Plot Style: 1=Line,2=Points,5=Bar Chart
    
    </td>
    <td>
    
    int
    
    </td>
    <td>
    
    plotStyleParam
    
    </td>
    <td>
    
    1
    
    </td>
    <td>
     </tr>
    
 



 <tr>
    <td>
    
    6
    
    </td>
    <td>
    
    Control: 1=On, 0=Off
    
    </td>
    <td>
    
    int
    
    </td>
    <td>
    
    control
    
    </td>
    <td>
    
    1
    
    </td>
    <td>
     </tr>
    
 



 <tr>
    <td>
    
    7
    
    </td>
    <td>
    
    0=Static,1=Dynamic
    
    </td>
    <td>
    
    int
    
    </td>
    <td>
    
    mode
    
    </td>
    <td>
    
    0
    
    </td>
    <td>
     </tr>
    
 



 <tr>
    <td>
    
    8
    
    </td>
    <td>
    
    Sampling Rate
    
    </td>
    <td>
    
    int
    
    </td>
    <td>
    
    samplingRate
    
    </td>
    <td>
    
    1
    
    </td>
    <td>
     </tr>
    
 



</table>




<h6><a href="#top">Top</a></h6>
<table width="746" border="1" cellspacing="1" cellpadding="1">
  <caption>
  <span class="style3">  States<a name="states"></a> </span>
  </caption>
  <tr>
    <th width="58" scope="col">Num</th>    
    <th width="80" scope="col">Type</th>
    <th width="98" scope="col">Name</th>
    <th width="109" scope="col">Initial Value </th>
    <th width="373" scope="col">Description</th>
  </tr>

  


 <tr>
    <td>
    
    0
    
    </td>
    <td>
    
  
    int
    
    </td>
    <td>
    
    ibufs
    
    </td>
    <td>
    
    
    
    </td>
    <td>
    
      
    
    </td>
     </tr>
    
 



 <tr>
    <td>
    
    1
    
    </td>
    <td>
    
  
    int
    
    </td>
    <td>
    
    obufs
    
    </td>
    <td>
    
    
    
    </td>
    <td>
    
      
    
    </td>
     </tr>
    
 



 <tr>
    <td>
    
    2
    
    </td>
    <td>
    
  
    float*
    
    </td>
    <td>
    
    xpts
    
    </td>
    <td>
    
    
    
    </td>
    <td>
    
      
    
    </td>
     </tr>
    
 



 <tr>
    <td>
    
    3
    
    </td>
    <td>
    
  
    float*
    
    </td>
    <td>
    
    ypts[MAX_NUMBER_OF_PLOTS]
    
    </td>
    <td>
    
    
    
    </td>
    <td>
    
      
    
    </td>
     </tr>
    
 



 <tr>
    <td>
    
    4
    
    </td>
    <td>
    
  
    char*
    
    </td>
    <td>
    
    legends[100]
    
    </td>
    <td>
    
    
    
    </td>
    <td>
    
      
    
    </td>
     </tr>
    
 



 <tr>
    <td>
    
    5
    
    </td>
    <td>
    
  
    int
    
    </td>
    <td>
    
    count
    
    </td>
    <td>
    
    0
    
    </td>
    <td>
    
      
    
    </td>
     </tr>
    
 



 <tr>
    <td>
    
    6
    
    </td>
    <td>
    
  
    int
    
    </td>
    <td>
    
    totalCount
    
    </td>
    <td>
    
    0
    
    </td>
    <td>
    
      
    
    </td>
     </tr>
    
 



 <tr>
    <td>
    
    7
    
    </td>
    <td>
    
  
    int
    
    </td>
    <td>
    
    displayed
    
    </td>
    <td>
    
    FALSE
    
    </td>
    <td>
    
      
    
    </td>
     </tr>
    
 



 <tr>
    <td>
    
    8
    
    </td>
    <td>
    
  
    float
    
    </td>
    <td>
    
    dt
    
    </td>
    <td>
    
    
    
    </td>
    <td>
    
      
    
    </td>
     </tr>
    
 



 <tr>
    <td>
    
    9
    
    </td>
    <td>
    
  
    int
    
    </td>
    <td>
    
    blockOff
    
    </td>
    <td>
    
    0
    
    </td>
    <td>
    
      
    
    </td>
     </tr>
    
 



 <tr>
    <td>
    
    10
    
    </td>
    <td>
    
  
    int
    
    </td>
    <td>
    
    bufi
    
    </td>
    <td>
    
    0
    
    </td>
    <td>
    
      
    
    </td>
     </tr>
    
 



</table>




<h6><a href="#top">Top</a></h6>
<h2>Declarations<a name="declarations"></a></h2>
<table width="754" height="98" border="1" cellpadding="1" cellspacing="1">
  <tr>
    <th class="style5" scope="col"><div align="left"> 
      <pre>

 

	int samples;
    	int i,j,k,ii;
	int	operState;
	char curveTitle[80];
	char curveSubTitle[80];
	char	fname[100];
	FILE *time_F;



</pre>
    </div></th>
  </tr>
</table>




<h6><a href="#top">Top</a></h6>
<h2>Initialization Code<a name="initialization"></a></h2>
<table width="754" height="98" border="1" cellpadding="1" cellspacing="1">
  <tr>
    <th class="style5" scope="col"><div align="left"> 
      <pre>


 

/* 
 * store as state the number of input/output buffers 
 */
if((ibufs = NO_INPUT_BUFFERS()) <= 0) {
	fprintf(stderr,"plot: no inputs connected\n");
	return(2);
}
if((obufs = NO_OUTPUT_BUFFERS()) > ibufs) {
	fprintf(stderr,"plot: too many outputs connected\n");
	return(3);
}
if(ibufs > MAX_NUMBER_OF_PLOTS) {
	fprintf(stderr,"plot: too many plots requested.  \n");
	return(4);
}
if(control && mode == DYNAMIC) {
	/*
	 * allocate arrays
	 */
	xpts = (float* )calloc(npts,sizeof(float));
	if(xpts==NULL) {
		fprintf(stderr,"Could not allocate space in plot \n");
		return(5);
	}
	for(i=0; i<ibufs; i++) {
	    ypts[i] = (float* )calloc(npts,sizeof(float));
	    if(ypts[i]==NULL) {
		fprintf(stderr,"Could not allocate space in plot \n");
		return(6);
	    }
	}
} else if(control && mode == STATIC) {
	/*
	 * allocate arrays
	 */
	xpts = (float* )calloc(BLOCK_SIZE,sizeof(float));
	if(xpts==NULL) {
		fprintf(stderr,"Could not allocate space in plot \n");
		return(5);
	}
	for(i=0; i<ibufs; i++) {
	    ypts[i] = (float* )calloc(BLOCK_SIZE,sizeof(float));
	    if(ypts[i]==NULL) {
		fprintf(stderr,"Could not allocate space in plot \n");
		return(6);
	    }
	}
 }
/* 
 * set up the legend first 
 */
for(i=0; i<ibufs; i++) 
	legends[i] = SNAME(i);
legends[ibufs] = NULL;
count = 0;
totalCount = 0;
dt=1.0/samplingRate;




</pre>
    </div></th>
  </tr>
</table>




<h6><a href="#top">Top</a></h6>
<h2>Main Code<a name="maincode"></a></h2>
<table width="754" height="98" border="1" cellpadding="1" cellspacing="1">
  <tr>
    <th class="style5" scope="col"><div align="left"> 
      <pre>


 


for(samples = MIN_AVAIL(); samples > 0; --samples) {

    


    for(i=0; i<ibufs; ++i) {
	   		IT_IN(i);
			if(obufs > i) {
				if(IT_OUT(i)) {
					KrnOverflow("plot",i);
					return(99);
				}
	 			OUTF(i,0) = INF(i,0);
			}
    }
    if(++totalCount > skip && control ) {
	if(mode == STATIC)
		count=blockOff + bufi;
	bufi++;

	if (bufi == BLOCK_SIZE && mode==STATIC) {
		blockOff += BLOCK_SIZE;
		xpts = (float *)realloc((char *) xpts,
			sizeof(float) * (blockOff + BLOCK_SIZE));
	        if(xpts==NULL) {
		         fprintf(stderr,"Could not allocate space in plot \n");
		         return(7);
	        }
		for(i=0; i<ibufs; i++) {
	    	     ypts[i] = (float* )realloc((char*)ypts[i],
				(blockOff+BLOCK_SIZE)*sizeof(float));
	             if(ypts[i]==NULL) {
		         fprintf(stderr,"Could not allocate space in plot \n");
		         return(8);
	             }
		}	
		bufi=0;

	}

	

	for(i=0; i<ibufs; ++i) 
       			ypts[i][count] = INF(i,0);


	xpts[count] = count*dt;
	if(mode == DYNAMIC) count++;
    }
}

return(0);





</pre>
    </div></th>
  </tr>
</table>




<h6><a href="#top">Top</a></h6>
<h2>Wrapup Code<a name="wrapup"></a></h2>
<table width="754" height="98" border="1" cellpadding="1" cellspacing="1">
  <tr>
    <th class="style5" scope="col"><div align="left"> 
      <pre>


 

if(control == 0) return(0);
if((totalCount - skip) > 0 ) {
   {
        	strcpy(fname,title);
       	 	strcat(fname,".tim");
        	time_F = fopen(fname,"w");
			for(k=0; k<ibufs; ++k) 
			   for(i=0; i<count; i++)
                	fprintf(time_F,"%e %e\n",xpts[i],ypts[k][i]);
		fclose(time_F);
		fprintf(stderr,"plot created file: %s \n",fname);
		free(xpts);
//		free(ypts);
	}
}




</pre>
    </div></th>
  </tr>
</table>




<h6><a href="#top">Top</a></h6>
<h2>License<a name="license"></a></h2>
<table width="754" height="98" border="1" cellpadding="1" cellspacing="1">
  <tr>
    <th class="style5" scope="col"><div align="left"> 
      <pre>


/*  Capsim (r) Text Mode Kernel (TMK) Star Library (Blocks)
    Copyright (C) 1989-2017  Silicon DSP Corporation

    This library is free software; you can redistribute it and/or
    modify it under the terms of the GNU Lesser General Public
    License as published by the Free Software Foundation; either
    version 2.1 of the License, or (at your option) any later version.

    This library is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
    Lesser General Public License for more details.

    You should have received a copy of the GNU Lesser General Public
    License along with this library; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

    http://www.silicondsp.com
    Silicon DSP  Corporation
    Las Vegas, Nevada
*/


</pre>
    </div></th>
  </tr>
</table>




<h6><a href="#top">Top</a></h6>
<h2>Description<a name="description"></a></h2>
<table width="754" height="98" border="1" cellpadding="1" cellspacing="1">
  <tr>
    <th class="style5" scope="col"><div align="left"> 
      <pre>


 

/* plottxt.s */
/**********************************************************************
                                plot()
***********************************************************************
	inputs:		(arbitrary number)
	outputs:	(optional feed-through of input channels)
	parameters:	int npts, the number of points to plot
			int skip, number of points to skip before first plot
			file title,  the title of the plot
			file x_axis, the title for the x_axis
			file y_axis, the title for the y_axis
			int plotQ plot quality flag 0 = high , 1 = low
*************************************************************************
This routine will produce a set of plots from an arbitrary number of input
channels.  Optionally, the input channel data can 'flow through' to the
correspondingly numbered output channel.  This is useful if this star is
to be placed in line in a simulation (e.g. probe).
The first parameter represents the number of points plotted from each channel.
EVERY TIME this number of points is input, a new set of plots will be generated.
Default is set to (int 500).
The second parameter is the number of points to skip before the first plot set
is presented.  This enables skipping of any transient period.
Default is set to (int 0).
The third parameter represents the title for the plot.
Default is set to "PLOT".
The fourth parameter represents the title for the x_axis.
Default is set to "X".
The fifth parameter represents the title for the y_axis.
Default is set to "Y".
Programmer:     Sasan H. Ardalan	
Date: 	 	June 18, 1990	
Modified: Sasan Ardalan, Added Dynamic Capability
*/




</pre>
    </div></th>
  </tr>
</table>




</body>
</html>


